---
title: "UserGuide"
format: html
editor: visual
---

## *bulktrends User Guide*

*Examples of how to use the `bulktrends` package. First, let's load all of the functions contained within the package.*

```{r}
#| code-fold: true
#| warning: false

library(data.table)
library(ggplot2)
library(devtools)
devtools::load_all("../")
```

## *Load UK Trade Info Bulk Data Files*

*Load a single bulk data file or all of the files in a directory (and subdirectories).*

```{r}
if (file.exists("../data/imports.rds")) {
  imports <- readRDS("../data/imports.rds")
} else {
  imports <- read_uktradeinfo( path = "../data/imports/")
  saveRDS(imports, file = "../data/imports.rds")
}

head(imports)

```

## *Request Data from UK Trade Data API*

*Download look-up tables, e.g. for commodity codes and ports, and save, or load if already available.*

```{r}
lookup_tables <- c("Commodity","Port")
for ( i in lookup_tables ) {
  
  file <- paste0("../data/",i,".rds")
  
  if( file.exists(file) ){
    assign(i,readRDS(file))
  
    } else {
    assign(i, uktrades_request(endpoint = i)$value)
    saveRDS(get(i), file = file)  
    
    }
}

```

## *Quick Visualisation*

-   *Plot time series of a single commodity*

-   *Plot the time series of all commodities in "chapter"*

```{r}

# Volume of single commodity
comcode_plot(imports, "01012990", variable="volume", lookup_table=Commodity, max_unique_comcodes = 10)

# Volume, weight and value of "chapter"
comcode_plot(imports, "01", variable="volume", lookup_table=Commodity, max_unique_comcodes = 10)
comcode_plot(imports, "01", variable="NET_MASS", lookup_table=Commodity, max_unique_comcodes = 10)
comcode_plot(imports, "01", variable="STAT_VALUE", lookup_table=Commodity, max_unique_comcodes = 10)

```

-   *Hierarchichal classification of a given commodity code*

```{r}

comcode_description("01012990", Commodity)
comcode_description("08039010", Commodity)
```

-   *Detection of outliers in time series of a single commodity*

```{r}

monthly_volume_outliers(imports, "01", Commodity)
monthly_volume_outliers(imports, "01012100", Commodity)
#monthly_volume_outliers(imports, "01012990", Commodity)
#monthly_volume_outliers(imports, "01061900", Commodity)
#monthly_volume_outliers(imports, "01069000", Commodity)
```
